<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preview - Procore Exhibit Generator</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 0;
            margin: 0;
        }
        .preview-container {
            background-color: white;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 20px auto;
        }
        .navbar-brand {
            font-weight: bold;
        }
        .toolbar {
            background-color: #f1f3f5;
            padding: 10px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .btn-toolbar {
            margin-left: auto;
        }
        @media print {
            .no-print {
                display: none;
            }
            body {
                background-color: white;
            }
            .preview-container {
                box-shadow: none;
                margin: 0;
                padding: 0;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark no-print">
        <div class="container">
            <a class="navbar-brand" href="index.html">Procore Exhibit Generator</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="generator.html">Generate Exhibit</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="settings.html">API Settings</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Toolbar -->
    <div class="toolbar d-flex align-items-center no-print">
        <h5 class="mb-0">Exhibit Preview</h5>
        <div class="btn-toolbar ms-auto">
            <button class="btn btn-outline-secondary me-2" id="printBtn">
                <i class="fas fa-print"></i> Print
            </button>
            <button class="btn btn-outline-primary me-2" id="pdfBtn">
                <i class="fas fa-file-pdf"></i> Save as PDF
            </button>
            <button class="btn btn-outline-success me-2" id="docxBtn">
                <i class="fas fa-file-word"></i> Save as DOCX
            </button>
            <button class="btn btn-outline-dark" id="backBtn">
                <i class="fas fa-arrow-left"></i> Back to Editor
            </button>
        </div>
    </div>

    <!-- Preview Container -->
    <div class="preview-container" id="previewContent">
        <p style="text-align: center;"><strong><u>EXHIBIT B &ndash; Scope of Work</u></strong></p>
        <p><strong><u>INTENT:</u></strong></p>
        <p>In general, this Bid Package is comprehensive to specific CSI Division Work and related Work as referenced, indicated on, or implied by the Project Drawings, Specifications and Project Manual. Subcontractor acknowledges that the following Scope of Work detail is provided as a courtesy and must be used in conjunction with <strong><u>all</u></strong> Project Documents. Scope of Work detail listed is not intended to describe a complete and final work scope. It is provided as a summary overview only.</p>
        <ol>
           <li>
              <strong>SCOPE OF WORK SUMMARY:</strong>
              <ol>
                 <li>The Scope of Work shall include the furnishing and installation, complete, of the <strong>FIRE PROTECTION Work</strong> as outlined in <strong><u>The Contract Bidding Requirements</u></strong> and in accordance with the <strong><u>Contract</u></strong><u><strong>Documents</strong></u><strong>.</strong></li>
                 <li>This shall include, but is not limited to all required, engineering, submittals (samples or mock-ups and shop drawings), materials, fabrication, labor, equipment and tools, supervision, hoisting, scaffolding, and transportation, licenses, burden and taxes, sales taxes, and insurances as required for a complete installation.</li>
                 <li>
                    The Scope of Work shall include, but not be limited to, all Division 01 General Requirements and all the Work in the following Specification Section(s), as further described herein:
                    <ol>
                       <li>019113 &ndash; General Commissioning Requirements</li>
                       <li>019114 &ndash; Functional Testing Requirements</li>
                       <li>All Division 21</li>
                       <li>078413 &ndash; Penetration Firestopping</li>
                       <li>078443 &ndash; Joint Firestopping</li>
                       <li>079219 &ndash; Acoustical Joint Sealants</li>
                       <li>083113 &ndash; Access Doors and Frames</li>
                    </ol>
                 </li>
              </ol>
           </li>
        </ol>
        <ul>
           <li>
              <strong>TRADE SPECIFIC SCOPE OF WORK ITEMS:</strong>
              <ol>
                 <li>
                    The following is a general outline of items included, but not limited to, under this agreement for <strong><em>Fire Protection </em></strong>in accordance with the Contract Documents:
                    <ol>
                       <li>Subcontractor is responsible for providing complete wet and dry sprinkler system design including complete submittal to the Architect/Engineer, appropriate governmental inspection and insurance agencies for approval.</li>
                       <li>Subcontractor shall furnish and install a complete wet and dry sprinkler systems.</li>
                       <li>All fire department connections, drain lines, and inspector test line locations shall be coordinated with Owner, Architect, DOI and local authority(s) having jurisdiction.</li>
                       <li>Fire pump and fire pump controller.</li>
                       <li>Insulate and heat trace wet system in parking deck that is routed through unheated space.</li>
                       <li>Subcontractor to provide temporary standpipes per NFPA, OSHA and AHJ requirements.</li>
                    </ol>
                 </li>
              </ol>
           </li>
        </ul>
        <ul>
           <li><strong>TRADE SPECIFIC SCOPE EXCLUSIONS</strong></li>
        </ul>
        <p>The following is a list of specific exclusions normally related to this scope of work:</p>
        <ol>
           <li>Payment and Performance Bond (XX rate X%), if approved to enroll into CMAR SDI program (By CMAR)</li>
        </ol>
        <ul>
           <li><strong>RECAP OF CONTRACT AMOUNT</strong></li>
        </ul>
        <p><strong><u>The Total Subcontract Amount is arrived at and recorded as follows:</u></strong></p>
        <p>BP-21A &ndash; Base Bid Amount $ TBD</p>
        <p>Add: Accepted Alternates $ TBD</p>
        <p>Other Additions / Deletions <u>$ TBD </u></p>
        <p><strong>TOTAL SUBCONTRACT AMOUNT $ TBD</strong></p>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <!-- DocxJS for DOCX generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.min.js"></script>
    <!-- PDF.js for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- html2canvas for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- FileSaver.js for downloading files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Button event listeners
            document.getElementById('printBtn').addEventListener('click', function() {
                window.print();
            });
            
            document.getElementById('pdfBtn').addEventListener('click', function() {
                generatePDF();
            });
            
            document.getElementById('docxBtn').addEventListener('click', function() {
                generateDOCX();
            });
            
            document.getElementById('backBtn').addEventListener('click', function() {
                window.location.href = 'generator.html';
            });
            
            // Get exhibit data from localStorage if available
            const exhibitData = JSON.parse(localStorage.getItem('exhibitData') || '{}');
            if (exhibitData.html) {
                document.getElementById('previewContent').innerHTML = exhibitData.html;
            }
            
            // Generate PDF
            async function generatePDF() {
                const { jsPDF } = window.jspdf;
                
                // Create loading indicator
                const loadingElement = document.createElement('div');
                loadingElement.style.position = 'fixed';
                loadingElement.style.top = '0';
                loadingElement.style.left = '0';
                loadingElement.style.width = '100%';
                loadingElement.style.height = '100%';
                loadingElement.style.backgroundColor = 'rgba(0,0,0,0.5)';
                loadingElement.style.display = 'flex';
                loadingElement.style.justifyContent = 'center';
                loadingElement.style.alignItems = 'center';
                loadingElement.style.zIndex = '9999';
                loadingElement.innerHTML = '<div style="background: white; padding: 20px; border-radius: 5px;"><h4>Generating PDF...</h4></div>';
                document.body.appendChild(loadingElement);
                
                try {
                    const contentElement = document.getElementById('previewContent');
                    
                    // Create PDF
                    const pdf = new jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4'
                    });
                    
                    // Use html2canvas to convert HTML to image
                    const canvas = await html2canvas(contentElement, {
                        scale: 2,
                        useCORS: true,
                        logging: false
                    });
                    
                    // Add image to PDF
                    const imgData = canvas.toDataURL('image/png');
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    const imgWidth = canvas.width;
                    const imgHeight = canvas.height;
                    const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                    const imgX = (pdfWidth - imgWidth * ratio) / 2;
                    const imgY = 0;
                    
                    pdf.addImage(imgData, 'PNG', imgX, imgY, imgWidth * ratio, imgHeight * ratio);
                    
                    // Save PDF
                    pdf.save('exhibit-document.pdf');
                    
                    // Remove loading indicator
                    document.body.removeChild(loadingElement);
                } catch (error) {
                    console.error('Error generating PDF:', error);
                    alert('Error generating PDF: ' + error.message);
                    // Remove loading indicator
                    document.body.removeChild(loadingElement);
                }
            }
            
            // Generate DOCX
            async function generateDOCX() {
                // This is a simplified implementation
                alert('DOCX generation would be implemented here. For a complete implementation, you would need to convert the HTML content to DOCX format using docx.js library.');
            }
        });
    </script>
</body>
</html>